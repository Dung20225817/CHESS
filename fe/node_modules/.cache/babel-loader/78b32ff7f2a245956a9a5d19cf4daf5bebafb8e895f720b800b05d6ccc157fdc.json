{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState } from \"react\";\nexport function useChessSocket(roomId, onUpdate) {\n  _s();\n  const ws = useRef(null);\n  const [playerColor, setPlayerColor] = useState(null);\n  const onUpdateRef = useRef(onUpdate);\n\n  // ‚úÖ C·∫≠p nh·∫≠t callback m·ªói khi onUpdate thay ƒë·ªïi, nh∆∞ng KH√îNG kh·ªüi t·∫°o l·∫°i WS\n  useEffect(() => {\n    onUpdateRef.current = onUpdate;\n  }, [onUpdate]);\n\n  // ‚úÖ Ch·ªâ kh·ªüi t·∫°o websocket 1 l·∫ßn duy nh·∫•t (khi roomId ƒë·ªïi)\n  useEffect(() => {\n    ws.current = new WebSocket(\"ws://localhost:8765\");\n    ws.current.onopen = () => {\n      var _ws$current;\n      (_ws$current = ws.current) === null || _ws$current === void 0 ? void 0 : _ws$current.send(JSON.stringify({\n        type: \"join\",\n        room: roomId\n      }));\n    };\n    ws.current.onmessage = event => {\n      const data = JSON.parse(event.data);\n      switch (data.type) {\n        case \"assignColor\":\n          setPlayerColor(data.color);\n          break;\n        case \"state\":\n          {\n            const fen = data.fen;\n            const turn = data.turn;\n            const gameOver = data.gameOver || null;\n            const evt = data.event || undefined; // üß© nh·∫≠n event t·ª´ server\n            onUpdateRef.current(fen, turn, gameOver, evt);\n            break;\n          }\n        case \"error\":\n          alert(data.msg);\n          break;\n        default:\n          console.warn(\"Unknown message type:\", data.type);\n      }\n    };\n    ws.current.onclose = () => {\n      console.log(\"Disconnected from server\");\n    };\n    return () => {\n      var _ws$current2;\n      (_ws$current2 = ws.current) === null || _ws$current2 === void 0 ? void 0 : _ws$current2.close();\n    };\n  }, [roomId]); // ‚úÖ ch·ªâ reconnect khi roomId thay ƒë·ªïi\n\n  const sendMove = moveUCI => {\n    var _ws$current3;\n    if (((_ws$current3 = ws.current) === null || _ws$current3 === void 0 ? void 0 : _ws$current3.readyState) === WebSocket.OPEN) {\n      ws.current.send(JSON.stringify({\n        type: \"move\",\n        move: moveUCI,\n        room: roomId\n      }));\n    } else {\n      console.warn(\"‚ö†Ô∏è WebSocket is not open. Cannot send move.\");\n    }\n  };\n  return {\n    sendMove,\n    playerColor\n  };\n}\n_s(useChessSocket, \"hZGfV5HmaA2OWzBmgCXCHJvkjZ8=\");","map":{"version":3,"names":["useEffect","useRef","useState","useChessSocket","roomId","onUpdate","_s","ws","playerColor","setPlayerColor","onUpdateRef","current","WebSocket","onopen","_ws$current","send","JSON","stringify","type","room","onmessage","event","data","parse","color","fen","turn","gameOver","evt","undefined","alert","msg","console","warn","onclose","log","_ws$current2","close","sendMove","moveUCI","_ws$current3","readyState","OPEN","move"],"sources":["D:/CHESS/fe/src/components/useChessSocket.ts"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\n\nexport function useChessSocket(\n  roomId: string,\n  onUpdate: (fen: string, turn: \"white\" | \"black\", gameOver: null | \"white\" | \"black\", event?: string) => void,\n) {\n  const ws = useRef<WebSocket | null>(null);\n  const [playerColor, setPlayerColor] = useState<\"white\" | \"black\" | null>(null);\n  const onUpdateRef = useRef(onUpdate);\n\n  // ‚úÖ C·∫≠p nh·∫≠t callback m·ªói khi onUpdate thay ƒë·ªïi, nh∆∞ng KH√îNG kh·ªüi t·∫°o l·∫°i WS\n  useEffect(() => {\n    onUpdateRef.current = onUpdate;\n  }, [onUpdate]);\n\n  // ‚úÖ Ch·ªâ kh·ªüi t·∫°o websocket 1 l·∫ßn duy nh·∫•t (khi roomId ƒë·ªïi)\n  useEffect(() => {\n    ws.current = new WebSocket(\"ws://localhost:8765\");\n\n    ws.current.onopen = () => {\n      ws.current?.send(JSON.stringify({ type: \"join\", room: roomId }));\n    };\n\n    ws.current.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n\n      switch (data.type) {\n        case \"assignColor\":\n          setPlayerColor(data.color);\n          break;\n\n        case \"state\":\n          {\n            const fen = data.fen;\n            const turn = data.turn;\n            const gameOver = data.gameOver || null;\n            const evt = data.event || undefined; // üß© nh·∫≠n event t·ª´ server\n            onUpdateRef.current(fen, turn, gameOver, evt);\n            break;\n          }\n\n        case \"error\":\n          alert(data.msg);\n          break;\n\n        default:\n          console.warn(\"Unknown message type:\", data.type);\n      }\n    };\n\n    ws.current.onclose = () => {\n      console.log(\"Disconnected from server\");\n    };\n\n    return () => {\n      ws.current?.close();\n    };\n  }, [roomId]); // ‚úÖ ch·ªâ reconnect khi roomId thay ƒë·ªïi\n\n  const sendMove = (moveUCI: string) => {\n    if (ws.current?.readyState === WebSocket.OPEN) {\n      ws.current.send(JSON.stringify({ type: \"move\", move: moveUCI, room: roomId }));\n    }\n    else {\n      console.warn(\"‚ö†Ô∏è WebSocket is not open. Cannot send move.\");\n    }\n  };\n\n  return { sendMove, playerColor };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}