{"ast":null,"code":"var _jsxFileName = \"D:\\\\CHESS\\\\fe\\\\src\\\\components\\\\connect\\\\AuthContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect, useRef } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUser] = useState(null);\n  const wsConn = useRef(null);\n\n  // Load user từ localStorage\n  useEffect(() => {\n    const saved = localStorage.getItem(\"auth_user\");\n    if (saved) setUser(JSON.parse(saved));\n  }, []);\n\n  // Hàm lưu user vào state + localStorage\n  const saveUser = u => {\n    setUser(u);\n    localStorage.setItem(\"auth_user\", JSON.stringify(u));\n  };\n\n  // Khởi tạo WebSocket nếu chưa có\n  const initWS = () => {\n    return new Promise((resolve, reject) => {\n      if (wsConn.current && wsConn.current.readyState === WebSocket.OPEN) {\n        resolve(wsConn.current);\n        return;\n      }\n      const proto = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n      const ws = new WebSocket(`${proto}//10.155.199.112:8765`);\n      ws.onopen = () => {\n        wsConn.current = ws;\n        resolve(ws);\n      };\n      ws.onerror = err => {\n        reject(err);\n      };\n\n      // Tự động clear ref khi đóng\n      ws.onclose = () => {\n        if (wsConn.current === ws) wsConn.current = null;\n      };\n    });\n  };\n\n  // ======================================================\n  // LOGIN\n  // ======================================================\n  const login = async (username, password) => {\n    try {\n      const ws = await initWS();\n      return new Promise(resolve => {\n        const listener = event => {\n          try {\n            const data = JSON.parse(event.data);\n            if (data.type === \"LOGIN\") {\n              ws.removeEventListener(\"message\", listener);\n              if (data.success) {\n                saveUser({\n                  username,\n                  user_id: data.user_id\n                });\n                resolve(true);\n              } else {\n                resolve(false);\n              }\n            }\n          } catch {\n            resolve(false);\n          }\n        };\n        ws.addEventListener(\"message\", listener);\n        ws.send(JSON.stringify({\n          type: \"LOGIN\",\n          username,\n          password\n        }));\n      });\n    } catch {\n      return false;\n    }\n  };\n\n  // ======================================================\n  // REGISTER\n  // ======================================================\n  const register = async (username, password) => {\n    try {\n      const ws = await initWS();\n      return new Promise(resolve => {\n        const listener = event => {\n          try {\n            const data = JSON.parse(event.data);\n            if (data.type === \"REGISTER\") {\n              ws.removeEventListener(\"message\", listener);\n              if (data.success) {\n                saveUser({\n                  username,\n                  user_id: data.user_id\n                });\n                resolve(true);\n              } else {\n                resolve(false);\n              }\n            }\n          } catch {\n            resolve(false);\n          }\n        };\n        ws.addEventListener(\"message\", listener);\n        ws.send(JSON.stringify({\n          type: \"REGISTER\",\n          username,\n          password\n        }));\n      });\n    } catch {\n      return false;\n    }\n  };\n\n  // ======================================================\n  // LOGOUT\n  // ======================================================\n  const logout = () => {\n    setUser(null);\n    localStorage.removeItem(\"auth_user\");\n    if (wsConn.current) {\n      wsConn.current.close();\n      wsConn.current = null;\n    }\n  };\n\n  // ======================================================\n  // GET FRIENDS\n  // ======================================================\n  const getFriends = async userId => {\n    try {\n      const ws = await initWS();\n      return new Promise(resolve => {\n        const listener = event => {\n          try {\n            const data = JSON.parse(event.data);\n            if (data.type === \"GET_FRIENDS\") {\n              ws.removeEventListener(\"message\", listener);\n              resolve(data.friends || []);\n            }\n          } catch {\n            resolve([]);\n          }\n        };\n        ws.addEventListener(\"message\", listener);\n        ws.send(JSON.stringify({\n          type: \"GET_FRIENDS\",\n          user_id: userId\n        }));\n      });\n    } catch {\n      return [];\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      login,\n      register,\n      logout,\n      getFriends\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 166,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"jTyu+f1A+6h1OWG2Otas8v/EAd0=\");\n_c = AuthProvider;\nexport const useAuth = () => {\n  _s2();\n  return useContext(AuthContext);\n};\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useRef","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","user","setUser","wsConn","saved","localStorage","getItem","JSON","parse","saveUser","u","setItem","stringify","initWS","Promise","resolve","reject","current","readyState","WebSocket","OPEN","proto","window","location","protocol","ws","onopen","onerror","err","onclose","login","username","password","listener","event","data","type","removeEventListener","success","user_id","addEventListener","send","register","logout","removeItem","close","getFriends","userId","friends","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","$RefreshReg$"],"sources":["D:/CHESS/fe/src/components/connect/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, useRef } from \"react\";\r\n\r\ntype User = { username: string; user_id: string };\r\ntype Friend = { friend_id: string; username: string };\r\n\r\ntype AuthContextType = {\r\n  user: User | null;\r\n  login: (username: string, password: string) => Promise<boolean>;\r\n  register: (username: string, password: string) => Promise<boolean>;\r\n  logout: () => void;\r\n  getFriends: (userId: string) => Promise<Friend[]>;\r\n};\r\n\r\nconst AuthContext = createContext<AuthContextType | null>(null);\r\n\r\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const wsConn = useRef<WebSocket | null>(null);\r\n\r\n  // Load user từ localStorage\r\n  useEffect(() => {\r\n    const saved = localStorage.getItem(\"auth_user\");\r\n    if (saved) setUser(JSON.parse(saved));\r\n  }, []);\r\n\r\n  // Hàm lưu user vào state + localStorage\r\n  const saveUser = (u: User) => {\r\n    setUser(u);\r\n    localStorage.setItem(\"auth_user\", JSON.stringify(u));\r\n  };\r\n\r\n  // Khởi tạo WebSocket nếu chưa có\r\n  const initWS = (): Promise<WebSocket> => {\r\n    return new Promise((resolve, reject) => {\r\n      if (wsConn.current && wsConn.current.readyState === WebSocket.OPEN) {\r\n        resolve(wsConn.current);\r\n        return;\r\n      }\r\n\r\n      const proto = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\r\n      const ws = new WebSocket(`${proto}//10.155.199.112:8765`);\r\n\r\n      ws.onopen = () => {\r\n        wsConn.current = ws;\r\n        resolve(ws);\r\n      };\r\n\r\n      ws.onerror = (err) => {\r\n        reject(err);\r\n      };\r\n\r\n      // Tự động clear ref khi đóng\r\n      ws.onclose = () => {\r\n        if (wsConn.current === ws) wsConn.current = null;\r\n      };\r\n    });\r\n  };\r\n\r\n  // ======================================================\r\n  // LOGIN\r\n  // ======================================================\r\n  const login = async (username: string, password: string): Promise<boolean> => {\r\n    try {\r\n      const ws = await initWS();\r\n\r\n      return new Promise((resolve) => {\r\n        const listener = (event: MessageEvent) => {\r\n          try {\r\n            const data = JSON.parse(event.data);\r\n            if (data.type === \"LOGIN\") {\r\n              ws.removeEventListener(\"message\", listener);\r\n              if (data.success) {\r\n                saveUser({ username, user_id: data.user_id });\r\n                resolve(true);\r\n              } else {\r\n                resolve(false);\r\n              }\r\n            }\r\n          } catch {\r\n            resolve(false);\r\n          }\r\n        };\r\n\r\n        ws.addEventListener(\"message\", listener);\r\n        ws.send(JSON.stringify({ type: \"LOGIN\", username, password }));\r\n      });\r\n    } catch {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // ======================================================\r\n  // REGISTER\r\n  // ======================================================\r\n  const register = async (username: string, password: string): Promise<boolean> => {\r\n    try {\r\n      const ws = await initWS();\r\n\r\n      return new Promise((resolve) => {\r\n        const listener = (event: MessageEvent) => {\r\n          try {\r\n            const data = JSON.parse(event.data);\r\n            if (data.type === \"REGISTER\") {\r\n              ws.removeEventListener(\"message\", listener);\r\n              if (data.success) {\r\n                saveUser({ username, user_id: data.user_id });\r\n                resolve(true);\r\n              } else {\r\n                resolve(false);\r\n              }\r\n            }\r\n          } catch {\r\n            resolve(false);\r\n          }\r\n        };\r\n\r\n        ws.addEventListener(\"message\", listener);\r\n        ws.send(JSON.stringify({ type: \"REGISTER\", username, password }));\r\n      });\r\n    } catch {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // ======================================================\r\n  // LOGOUT\r\n  // ======================================================\r\n  const logout = () => {\r\n    setUser(null);\r\n    localStorage.removeItem(\"auth_user\");\r\n    if (wsConn.current) {\r\n      wsConn.current.close();\r\n      wsConn.current = null;\r\n    }\r\n  };\r\n\r\n  // ======================================================\r\n  // GET FRIENDS\r\n  // ======================================================\r\n  const getFriends = async (userId: string): Promise<Friend[]> => {\r\n    try {\r\n      const ws = await initWS();\r\n\r\n      return new Promise((resolve) => {\r\n        const listener = (event: MessageEvent) => {\r\n          try {\r\n            const data = JSON.parse(event.data);\r\n            if (data.type === \"GET_FRIENDS\") {\r\n              ws.removeEventListener(\"message\", listener);\r\n              resolve(data.friends || []);\r\n            }\r\n          } catch {\r\n            resolve([]);\r\n          }\r\n        };\r\n\r\n        ws.addEventListener(\"message\", listener);\r\n        ws.send(JSON.stringify({ type: \"GET_FRIENDS\", user_id: userId }));\r\n      });\r\n    } catch {\r\n      return [];\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, login, register, logout, getFriends }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => useContext(AuthContext)!;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}