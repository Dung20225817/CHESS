{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\PycharmProjects\\\\Chess\\\\fe\\\\src\\\\components\\\\Board.tsx\",\n  _s = $RefreshSig$();\nimport { useState } from \"react\";\nimport Square from \"./Square\";\nimport { isValidMove } from \"./chessRules\";\nimport { useChessSocket } from \"./useChessSocket\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst pieceImages = {\n  P: \"/pieces/wP.png\",\n  p: \"/pieces/bP.png\",\n  R: \"/pieces/wR.png\",\n  r: \"/pieces/bR.png\",\n  N: \"/pieces/wN.png\",\n  n: \"/pieces/bN.png\",\n  B: \"/pieces/wB.png\",\n  b: \"/pieces/bB.png\",\n  Q: \"/pieces/wQ.png\",\n  q: \"/pieces/bQ.png\",\n  K: \"/pieces/wK.png\",\n  k: \"/pieces/bK.png\"\n};\nconst initialBoard = [\"rnbqkbnr\", \"pppppppp\", \"........\", \"........\", \"........\", \"........\", \"PPPPPPPP\", \"RNBQKBNR\"];\nconst Board = ({\n  roomId\n}) => {\n  _s();\n  const [board, setBoard] = useState(initialBoard.map(r => r.split(\"\")));\n  const [selected, setSelected] = useState(null);\n  const [validMoves, setValidMoves] = useState([]);\n  const [turn, setTurn] = useState(\"white\");\n  const [kingMoved, setKingMoved] = useState({\n    white: false,\n    black: false\n  });\n  const [rookMoved, setRookMoved] = useState({\n    wA: false,\n    wH: false,\n    bA: false,\n    bH: false\n  });\n  const [gameOver, setGameOver] = useState(null);\n\n  // WebSocket hook\n  const {\n    sendMove\n  } = useChessSocket(roomId, fen => {\n    const rows = fen.split(\" \")[0].split(\"/\").map(r => r.split(\"\").flatMap(c => isNaN(+c) ? [c] : Array(+c).fill(\".\")));\n    setBoard(rows);\n    setTurn(fen.split(\" \")[1] === \"w\" ? \"white\" : \"black\");\n  });\n  const handleClick = (r, c) => {\n    if (gameOver) return;\n    const piece = board[r][c];\n    const pieceColor = piece.toUpperCase() === piece ? \"white\" : \"black\";\n\n    // Chọn quân\n    if (!selected) {\n      if (piece !== \".\" && pieceColor === turn) {\n        setSelected([r, c]);\n        const moves = [];\n        for (let i = 0; i < 8; i++) for (let j = 0; j < 8; j++) if (isValidMove(piece, r, c, i, j, board, kingMoved, rookMoved)) moves.push([i, j]);\n        setValidMoves(moves);\n      }\n      return;\n    }\n    const [r1, c1] = selected;\n    const selectedPiece = board[r1][c1];\n    if (!selectedPiece || selectedPiece === \".\") {\n      setSelected(null);\n      setValidMoves([]);\n      return;\n    }\n\n    // Nếu click vào ô hợp lệ\n    if (validMoves.some(([x, y]) => x === r && y === c)) {\n      const moveUCI = `${String.fromCharCode(97 + c1)}${8 - r1}${String.fromCharCode(97 + c)}${8 - r}`;\n      sendMove(moveUCI); // gửi move lên server\n    }\n    setSelected(null);\n    setValidMoves([]);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [gameOver && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        color: \"red\",\n        textAlign: \"center\",\n        fontSize: \"20px\",\n        marginBottom: \"10px\"\n      },\n      children: gameOver === \"white\" ? \"Trắng thắng!\" : \"Đen thắng!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 20\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"grid\",\n        gridTemplateColumns: \"repeat(8, 60px)\",\n        gridTemplateRows: \"repeat(8, 60px)\",\n        border: \"2px solid black\"\n      },\n      children: board.map((row, i) => row.map((piece, j) => {\n        const color = (i + j) % 2 === 0 ? \"#f0d9b5\" : \"#b58863\";\n        const piecePath = pieceImages[piece] || \"\";\n        const isSelected = (selected === null || selected === void 0 ? void 0 : selected[0]) === i && (selected === null || selected === void 0 ? void 0 : selected[1]) === j;\n        const isValid = validMoves.some(([x, y]) => x === i && y === j);\n        const bgColor = isSelected ? \"yellow\" : isValid ? \"#a0d8ff\" : color;\n        return /*#__PURE__*/_jsxDEV(Square, {\n          value: piecePath,\n          isSelected: isSelected,\n          onClick: () => handleClick(i, j),\n          color: bgColor\n        }, `${i}-${j}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 20\n        }, this);\n      }))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 5\n  }, this);\n};\n_s(Board, \"Dq0BSbOmeKP3pZ9PFRVASsUv7dY=\", false, function () {\n  return [useChessSocket];\n});\n_c = Board;\nexport default Board;\nvar _c;\n$RefreshReg$(_c, \"Board\");","map":{"version":3,"names":["useState","Square","isValidMove","useChessSocket","jsxDEV","_jsxDEV","pieceImages","P","p","R","r","N","n","B","b","Q","q","K","k","initialBoard","Board","roomId","_s","board","setBoard","map","split","selected","setSelected","validMoves","setValidMoves","turn","setTurn","kingMoved","setKingMoved","white","black","rookMoved","setRookMoved","wA","wH","bA","bH","gameOver","setGameOver","sendMove","fen","rows","flatMap","c","isNaN","Array","fill","handleClick","piece","pieceColor","toUpperCase","moves","i","j","push","r1","c1","selectedPiece","some","x","y","moveUCI","String","fromCharCode","children","style","color","textAlign","fontSize","marginBottom","fileName","_jsxFileName","lineNumber","columnNumber","display","gridTemplateColumns","gridTemplateRows","border","row","piecePath","isSelected","isValid","bgColor","value","onClick","_c","$RefreshReg$"],"sources":["C:/Users/User/PycharmProjects/Chess/fe/src/components/Board.tsx"],"sourcesContent":["import { useState } from \"react\";\nimport Square from \"./Square\";\nimport { isValidMove, KingMoved, RookMoved } from \"./chessRules\";\nimport { useChessSocket } from \"./useChessSocket\";\n\nconst pieceImages: { [key: string]: string } = {\n  P: \"/pieces/wP.png\", p: \"/pieces/bP.png\",\n  R: \"/pieces/wR.png\", r: \"/pieces/bR.png\",\n  N: \"/pieces/wN.png\", n: \"/pieces/bN.png\",\n  B: \"/pieces/wB.png\", b: \"/pieces/bB.png\",\n  Q: \"/pieces/wQ.png\", q: \"/pieces/bQ.png\",\n  K: \"/pieces/wK.png\", k: \"/pieces/bK.png\",\n};\n\nconst initialBoard: string[] = [\n  \"rnbqkbnr\",\n  \"pppppppp\",\n  \"........\",\n  \"........\",\n  \"........\",\n  \"........\",\n  \"PPPPPPPP\",\n  \"RNBQKBNR\",\n];\n\nconst Board: React.FC<{ roomId: string }> = ({ roomId }) => {\n  const [board, setBoard] = useState<string[][]>(initialBoard.map(r => r.split(\"\")));\n  const [selected, setSelected] = useState<[number, number] | null>(null);\n  const [validMoves, setValidMoves] = useState<[number, number][]>([]);\n  const [turn, setTurn] = useState<\"white\" | \"black\">(\"white\");\n  const [kingMoved, setKingMoved] = useState<KingMoved>({ white: false, black: false });\n  const [rookMoved, setRookMoved] = useState<RookMoved>({ wA: false, wH: false, bA: false, bH: false });\n  const [gameOver, setGameOver] = useState<null | \"white\" | \"black\">(null);\n\n  // WebSocket hook\n  const { sendMove } = useChessSocket(roomId, (fen) => {\n    const rows = fen.split(\" \")[0].split(\"/\").map(r =>\n      r.split(\"\").flatMap(c => isNaN(+c) ? [c] : Array(+c).fill(\".\"))\n    );\n    setBoard(rows as string[][]);\n    setTurn(fen.split(\" \")[1] === \"w\" ? \"white\" : \"black\");\n  });\n\n  const handleClick = (r: number, c: number) => {\n    if (gameOver) return;\n    const piece = board[r][c];\n    const pieceColor = piece.toUpperCase() === piece ? \"white\" : \"black\";\n\n    // Chọn quân\n    if (!selected) {\n      if (piece !== \".\" && pieceColor === turn) {\n        setSelected([r, c]);\n        const moves: [number, number][] = [];\n        for (let i = 0; i < 8; i++)\n          for (let j = 0; j < 8; j++)\n            if (isValidMove(piece, r, c, i, j, board, kingMoved, rookMoved))\n              moves.push([i, j]);\n        setValidMoves(moves);\n      }\n      return;\n    }\n\n    const [r1, c1] = selected;\n    const selectedPiece = board[r1][c1];\n    if (!selectedPiece || selectedPiece === \".\") {\n      setSelected(null);\n      setValidMoves([]);\n      return;\n    }\n\n    // Nếu click vào ô hợp lệ\n    if (validMoves.some(([x, y]) => x === r && y === c)) {\n      const moveUCI = `${String.fromCharCode(97 + c1)}${8 - r1}${String.fromCharCode(97 + c)}${8 - r}`;\n      sendMove(moveUCI); // gửi move lên server\n    }\n\n    setSelected(null);\n    setValidMoves([]);\n  };\n\n  return (\n    <div>\n      {gameOver && <div style={{ color: \"red\", textAlign: \"center\", fontSize: \"20px\", marginBottom: \"10px\" }}>\n        {gameOver === \"white\" ? \"Trắng thắng!\" : \"Đen thắng!\"}\n      </div>}\n\n      <div style={{ display: \"grid\", gridTemplateColumns: \"repeat(8, 60px)\", gridTemplateRows: \"repeat(8, 60px)\", border: \"2px solid black\" }}>\n        {board.map((row, i) =>\n          row.map((piece, j) => {\n            const color = (i + j) % 2 === 0 ? \"#f0d9b5\" : \"#b58863\";\n            const piecePath = pieceImages[piece] || \"\";\n            const isSelected = selected?.[0] === i && selected?.[1] === j;\n            const isValid = validMoves.some(([x, y]) => x === i && y === j);\n            const bgColor = isSelected ? \"yellow\" : isValid ? \"#a0d8ff\" : color;\n            return <Square key={`${i}-${j}`} value={piecePath} isSelected={isSelected} onClick={() => handleClick(i, j)} color={bgColor} />;\n          })\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Board;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}