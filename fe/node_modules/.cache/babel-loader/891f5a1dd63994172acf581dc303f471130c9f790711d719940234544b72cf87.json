{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState } from \"react\";\nexport function useChessSocket(roomId, onUpdateBoard) {\n  _s();\n  const ws = useRef(\"white\");\n  const [playerColor, setPlayerColor] = useState(\"white\");\n  useEffect(() => {\n    ws.current = new WebSocket(\"ws://localhost:8765\");\n    ws.current.onopen = () => {\n      var _ws$current;\n      (_ws$current = ws.current) === null || _ws$current === void 0 ? void 0 : _ws$current.send(JSON.stringify({\n        type: \"join\",\n        room: roomId\n      }));\n    };\n    ws.current.onmessage = event => {\n      const data = JSON.parse(event.data);\n      if (data.type === \"state\") {\n        // phân màu người chơi\n        if (!playerColor) {\n          setPlayerColor(\"white\"); // mặc định, server có thể gửi index\n        }\n        const fen = data.fen;\n        const turn = fen.split(\" \")[1] === \"w\" ? \"white\" : \"black\";\n        onUpdateBoard(fen, turn);\n      }\n      if (data.type === \"move\") {\n        const fen = data.fen;\n        const turn = fen.split(\" \")[1] === \"w\" ? \"white\" : \"black\";\n        onUpdateBoard(fen, turn);\n      }\n    };\n    return () => {\n      var _ws$current2;\n      (_ws$current2 = ws.current) === null || _ws$current2 === void 0 ? void 0 : _ws$current2.close();\n    };\n  }, [roomId]);\n  const sendMove = uci => {\n    var _ws$current3;\n    if (((_ws$current3 = ws.current) === null || _ws$current3 === void 0 ? void 0 : _ws$current3.readyState) === WebSocket.OPEN) {\n      ws.current.send(JSON.stringify({\n        type: \"move\",\n        room: roomId,\n        move: uci\n      }));\n    }\n  };\n  return {\n    sendMove,\n    playerColor\n  };\n}\n_s(useChessSocket, \"btRbxz/3O5zGDIaJQUCjaOO74p0=\");","map":{"version":3,"names":["useEffect","useRef","useState","useChessSocket","roomId","onUpdateBoard","_s","ws","playerColor","setPlayerColor","current","WebSocket","onopen","_ws$current","send","JSON","stringify","type","room","onmessage","event","data","parse","fen","turn","split","_ws$current2","close","sendMove","uci","_ws$current3","readyState","OPEN","move"],"sources":["C:/Users/User/PycharmProjects/Chess/fe/src/components/useChessSocket.ts"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\n\nexport function useChessSocket(\n  roomId: string,\n  onUpdateBoard: (fen: string, turn: \"white\" | \"black\") => void\n) {\n  const ws = useRef<\"white\" | \"black\">(\"white\");\n  const [playerColor, setPlayerColor] = useState<\"white\" | \"black\">(\"white\");\n\n  useEffect(() => {\n    ws.current = new WebSocket(\"ws://localhost:8765\");\n    ws.current.onopen = () => {\n      ws.current?.send(JSON.stringify({ type: \"join\", room: roomId }));\n    };\n    ws.current.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      if (data.type === \"state\") {\n        // phân màu người chơi\n        if (!playerColor) {\n          setPlayerColor(\"white\"); // mặc định, server có thể gửi index\n        }\n        const fen = data.fen;\n        const turn = fen.split(\" \")[1] === \"w\" ? \"white\" : \"black\";\n        onUpdateBoard(fen, turn);\n      }\n      if (data.type === \"move\") {\n        const fen = data.fen;\n        const turn = fen.split(\" \")[1] === \"w\" ? \"white\" : \"black\";\n        onUpdateBoard(fen, turn);\n      }\n    };\n    return () => {\n      ws.current?.close();\n    };\n  }, [roomId]);\n\n  const sendMove = (uci: string) => {\n    if (ws.current?.readyState === WebSocket.OPEN) {\n      ws.current.send(JSON.stringify({ type: \"move\", room: roomId, move: uci }));\n    }\n  };\n\n  return { sendMove, playerColor };\n}\n"],"mappings":";AAAA,SAASA,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AAEnD,OAAO,SAASC,cAAcA,CAC5BC,MAAc,EACdC,aAA6D,EAC7D;EAAAC,EAAA;EACA,MAAMC,EAAE,GAAGN,MAAM,CAAoB,OAAO,CAAC;EAC7C,MAAM,CAACO,WAAW,EAAEC,cAAc,CAAC,GAAGP,QAAQ,CAAoB,OAAO,CAAC;EAE1EF,SAAS,CAAC,MAAM;IACdO,EAAE,CAACG,OAAO,GAAG,IAAIC,SAAS,CAAC,qBAAqB,CAAC;IACjDJ,EAAE,CAACG,OAAO,CAACE,MAAM,GAAG,MAAM;MAAA,IAAAC,WAAA;MACxB,CAAAA,WAAA,GAAAN,EAAE,CAACG,OAAO,cAAAG,WAAA,uBAAVA,WAAA,CAAYC,IAAI,CAACC,IAAI,CAACC,SAAS,CAAC;QAAEC,IAAI,EAAE,MAAM;QAAEC,IAAI,EAAEd;MAAO,CAAC,CAAC,CAAC;IAClE,CAAC;IACDG,EAAE,CAACG,OAAO,CAACS,SAAS,GAAIC,KAAK,IAAK;MAChC,MAAMC,IAAI,GAAGN,IAAI,CAACO,KAAK,CAACF,KAAK,CAACC,IAAI,CAAC;MACnC,IAAIA,IAAI,CAACJ,IAAI,KAAK,OAAO,EAAE;QACzB;QACA,IAAI,CAACT,WAAW,EAAE;UAChBC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAC3B;QACA,MAAMc,GAAG,GAAGF,IAAI,CAACE,GAAG;QACpB,MAAMC,IAAI,GAAGD,GAAG,CAACE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,GAAG,OAAO,GAAG,OAAO;QAC1DpB,aAAa,CAACkB,GAAG,EAAEC,IAAI,CAAC;MAC1B;MACA,IAAIH,IAAI,CAACJ,IAAI,KAAK,MAAM,EAAE;QACxB,MAAMM,GAAG,GAAGF,IAAI,CAACE,GAAG;QACpB,MAAMC,IAAI,GAAGD,GAAG,CAACE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,GAAG,OAAO,GAAG,OAAO;QAC1DpB,aAAa,CAACkB,GAAG,EAAEC,IAAI,CAAC;MAC1B;IACF,CAAC;IACD,OAAO,MAAM;MAAA,IAAAE,YAAA;MACX,CAAAA,YAAA,GAAAnB,EAAE,CAACG,OAAO,cAAAgB,YAAA,uBAAVA,YAAA,CAAYC,KAAK,CAAC,CAAC;IACrB,CAAC;EACH,CAAC,EAAE,CAACvB,MAAM,CAAC,CAAC;EAEZ,MAAMwB,QAAQ,GAAIC,GAAW,IAAK;IAAA,IAAAC,YAAA;IAChC,IAAI,EAAAA,YAAA,GAAAvB,EAAE,CAACG,OAAO,cAAAoB,YAAA,uBAAVA,YAAA,CAAYC,UAAU,MAAKpB,SAAS,CAACqB,IAAI,EAAE;MAC7CzB,EAAE,CAACG,OAAO,CAACI,IAAI,CAACC,IAAI,CAACC,SAAS,CAAC;QAAEC,IAAI,EAAE,MAAM;QAAEC,IAAI,EAAEd,MAAM;QAAE6B,IAAI,EAAEJ;MAAI,CAAC,CAAC,CAAC;IAC5E;EACF,CAAC;EAED,OAAO;IAAED,QAAQ;IAAEpB;EAAY,CAAC;AAClC;AAACF,EAAA,CAzCeH,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}