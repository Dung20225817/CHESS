{"ast":null,"code":"// chessRules.ts\n\n// Hàm kiểm tra di chuyển hợp lệ\nexport function isValidMove(piece, r1, c1, r2, c2, board, kingMoved, rookMoved) {\n  const target = board[r2][c2];\n\n  // Không ăn quân cùng màu\n  if (piece === piece.toUpperCase() && target !== \".\" && target === target.toUpperCase()) return false;\n  if (piece === piece.toLowerCase() && target !== \".\" && target === target.toLowerCase()) return false;\n  switch (piece.toLowerCase()) {\n    case \"p\":\n      {\n        const direction = piece === \"P\" ? -1 : 1;\n        const startRow = piece === \"P\" ? 6 : 1;\n        if (c1 === c2 && r2 === r1 + direction && board[r2][c2] === \".\") return true;\n        if (c1 === c2 && r1 === startRow && r2 === r1 + 2 * direction && board[r1 + direction][c1] === \".\" && board[r2][c2] === \".\") return true;\n        if (Math.abs(c2 - c1) === 1 && r2 === r1 + direction && target !== \".\") return true;\n        return false;\n      }\n    case \"r\":\n      {\n        if (r1 === r2) {\n          const min = Math.min(c1, c2) + 1;\n          const max = Math.max(c1, c2);\n          for (let c = min; c < max; c++) if (board[r1][c] !== \".\") return false;\n          return true;\n        } else if (c1 === c2) {\n          const min = Math.min(r1, r2) + 1;\n          const max = Math.max(r1, r2);\n          for (let r = min; r < max; r++) if (board[r][c1] !== \".\") return false;\n          return true;\n        }\n        return false;\n      }\n    case \"n\":\n      return Math.abs(r2 - r1) === 2 && Math.abs(c2 - c1) === 1 || Math.abs(r2 - r1) === 1 && Math.abs(c2 - c1) === 2;\n    case \"b\":\n      {\n        if (Math.abs(r2 - r1) !== Math.abs(c2 - c1)) return false;\n        const dr = r2 > r1 ? 1 : -1;\n        const dc = c2 > c1 ? 1 : -1;\n        let r = r1 + dr,\n          c = c1 + dc;\n        while (r !== r2 && c !== c2) {\n          if (board[r][c] !== \".\") return false;\n          r += dr;\n          c += dc;\n        }\n        return true;\n      }\n    case \"q\":\n      return isValidMove(piece === \"Q\" ? \"R\" : \"r\", r1, c1, r2, c2, board, kingMoved, rookMoved) || isValidMove(piece === \"Q\" ? \"B\" : \"b\", r1, c1, r2, c2, board, kingMoved, rookMoved);\n    case \"k\":\n      {\n        if (Math.abs(r2 - r1) <= 1 && Math.abs(c2 - c1) <= 1) return true;\n\n        // Castling trắng\n        if (piece === \"K\" && r1 === 7 && r2 === 7) {\n          if (c1 === 4 && c2 === 6 && !kingMoved.white && !rookMoved.wH && board[7][5] === \".\" && board[7][6] === \".\") return true;\n          if (c1 === 4 && c2 === 2 && !kingMoved.white && !rookMoved.wA && board[7][1] === \".\" && board[7][2] === \".\" && board[7][3] === \".\") return true;\n        }\n        // Castling đen\n        if (piece === \"k\" && r1 === 0 && r2 === 0) {\n          if (c1 === 4 && c2 === 6 && !kingMoved.black && !rookMoved.bH && board[0][5] === \".\" && board[0][6] === \".\") return true;\n          if (c1 === 4 && c2 === 2 && !kingMoved.black && !rookMoved.bA && board[0][1] === \".\" && board[0][2] === \".\" && board[0][3] === \".\") return true;\n        }\n        return false;\n      }\n    default:\n      return false;\n  }\n}","map":{"version":3,"names":["isValidMove","piece","r1","c1","r2","c2","board","kingMoved","rookMoved","target","toUpperCase","toLowerCase","direction","startRow","Math","abs","min","max","c","r","dr","dc","white","wH","wA","black","bH","bA"],"sources":["C:/Users/User/PycharmProjects/Chess/fe/src/components/chessRules.ts"],"sourcesContent":["// chessRules.ts\nexport type KingMoved = { white: boolean; black: boolean };\nexport type RookMoved = { wA: boolean; wH: boolean; bA: boolean; bH: boolean };\n\n// Hàm kiểm tra di chuyển hợp lệ\nexport function isValidMove(\n  piece: string,\n  r1: number,\n  c1: number,\n  r2: number,\n  c2: number,\n  board: string[][],\n  kingMoved: KingMoved,\n  rookMoved: RookMoved\n): boolean {\n  const target = board[r2][c2];\n\n  // Không ăn quân cùng màu\n  if (piece === piece.toUpperCase() && target !== \".\" && target === target.toUpperCase()) return false;\n  if (piece === piece.toLowerCase() && target !== \".\" && target === target.toLowerCase()) return false;\n\n  switch (piece.toLowerCase()) {\n    case \"p\": {\n      const direction = piece === \"P\" ? -1 : 1;\n      const startRow = piece === \"P\" ? 6 : 1;\n      if (c1 === c2 && r2 === r1 + direction && board[r2][c2] === \".\") return true;\n      if (c1 === c2 && r1 === startRow && r2 === r1 + 2 * direction && board[r1 + direction][c1] === \".\" && board[r2][c2] === \".\") return true;\n      if (Math.abs(c2 - c1) === 1 && r2 === r1 + direction && target !== \".\") return true;\n      return false;\n    }\n    case \"r\": {\n      if (r1 === r2) {\n        const min = Math.min(c1, c2) + 1;\n        const max = Math.max(c1, c2);\n        for (let c = min; c < max; c++) if (board[r1][c] !== \".\") return false;\n        return true;\n      } else if (c1 === c2) {\n        const min = Math.min(r1, r2) + 1;\n        const max = Math.max(r1, r2);\n        for (let r = min; r < max; r++) if (board[r][c1] !== \".\") return false;\n        return true;\n      }\n      return false;\n    }\n    case \"n\":\n      return (Math.abs(r2 - r1) === 2 && Math.abs(c2 - c1) === 1) || (Math.abs(r2 - r1) === 1 && Math.abs(c2 - c1) === 2);\n    case \"b\": {\n      if (Math.abs(r2 - r1) !== Math.abs(c2 - c1)) return false;\n      const dr = r2 > r1 ? 1 : -1;\n      const dc = c2 > c1 ? 1 : -1;\n      let r = r1 + dr, c = c1 + dc;\n      while (r !== r2 && c !== c2) {\n        if (board[r][c] !== \".\") return false;\n        r += dr;\n        c += dc;\n      }\n      return true;\n    }\n    case \"q\":\n      return isValidMove(piece === \"Q\" ? \"R\" : \"r\", r1, c1, r2, c2, board, kingMoved, rookMoved) ||\n             isValidMove(piece === \"Q\" ? \"B\" : \"b\", r1, c1, r2, c2, board, kingMoved, rookMoved);\n    case \"k\": {\n      if (Math.abs(r2 - r1) <= 1 && Math.abs(c2 - c1) <= 1) return true;\n\n      // Castling trắng\n      if (piece === \"K\" && r1 === 7 && r2 === 7) {\n        if (c1 === 4 && c2 === 6 && !kingMoved.white && !rookMoved.wH && board[7][5] === \".\" && board[7][6] === \".\") return true;\n        if (c1 === 4 && c2 === 2 && !kingMoved.white && !rookMoved.wA && board[7][1] === \".\" && board[7][2] === \".\" && board[7][3] === \".\") return true;\n      }\n      // Castling đen\n      if (piece === \"k\" && r1 === 0 && r2 === 0) {\n        if (c1 === 4 && c2 === 6 && !kingMoved.black && !rookMoved.bH && board[0][5] === \".\" && board[0][6] === \".\") return true;\n        if (c1 === 4 && c2 === 2 && !kingMoved.black && !rookMoved.bA && board[0][1] === \".\" && board[0][2] === \".\" && board[0][3] === \".\") return true;\n      }\n\n      return false;\n    }\n    default:\n      return false;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}