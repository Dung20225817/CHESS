{"ast":null,"code":"import{useEffect,useRef,useState}from\"react\";export function useChessSocket(roomId,onUpdate){const ws=useRef(null);const[playerColor,setPlayerColor]=useState(null);useEffect(()=>{ws.current=new WebSocket(\"ws://localhost:8765\");ws.current.onopen=()=>{var _ws$current;(_ws$current=ws.current)===null||_ws$current===void 0?void 0:_ws$current.send(JSON.stringify({type:\"join\",room:roomId}));};ws.current.onmessage=event=>{const data=JSON.parse(event.data);switch(data.type){case\"assignColor\":setPlayerColor(data.color);break;case\"state\":// chỉ cập nhật khi đã có playerColor\nif(playerColor){onUpdate(data.fen,data.turn,data.gameOver||null);}break;case\"error\":alert(data.msg);break;default:console.warn(\"Unknown message type:\",data.type);}};ws.current.onclose=()=>{console.log(\"Disconnected from server\");};return()=>{var _ws$current2;(_ws$current2=ws.current)===null||_ws$current2===void 0?void 0:_ws$current2.close();};},[roomId,onUpdate,playerColor]);const sendMove=moveUCI=>{var _ws$current3;if(((_ws$current3=ws.current)===null||_ws$current3===void 0?void 0:_ws$current3.readyState)===WebSocket.OPEN){ws.current.send(JSON.stringify({type:\"move\",move:moveUCI,room:roomId}));}};return{sendMove,playerColor};}","map":{"version":3,"names":["useEffect","useRef","useState","useChessSocket","roomId","onUpdate","ws","playerColor","setPlayerColor","current","WebSocket","onopen","_ws$current","send","JSON","stringify","type","room","onmessage","event","data","parse","color","fen","turn","gameOver","alert","msg","console","warn","onclose","log","_ws$current2","close","sendMove","moveUCI","_ws$current3","readyState","OPEN","move"],"sources":["C:/Users/User/PycharmProjects/Chess/fe/src/components/useChessSocket.ts"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\n\nexport function useChessSocket(\n  roomId: string,\n  onUpdate: (fen: string, turn: \"white\" | \"black\", gameOver: null | \"white\" | \"black\") => void\n) {\n  const ws = useRef<WebSocket | null>(null);\n  const [playerColor, setPlayerColor] = useState<\"white\" | \"black\" | null>(null);\n\n  useEffect(() => {\n    ws.current = new WebSocket(\"ws://localhost:8765\");\n\n    ws.current.onopen = () => {\n      ws.current?.send(JSON.stringify({ type: \"join\", room: roomId }));\n    };\n\n    ws.current.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n\n      switch (data.type) {\n        case \"assignColor\":\n          setPlayerColor(data.color);\n          break;\n\n        case \"state\":\n          // chỉ cập nhật khi đã có playerColor\n          if (playerColor) {\n            onUpdate(data.fen, data.turn, data.gameOver || null);\n          }\n          break;\n\n        case \"error\":\n          alert(data.msg);\n          break;\n\n        default:\n          console.warn(\"Unknown message type:\", data.type);\n      }\n    };\n\n    ws.current.onclose = () => {\n      console.log(\"Disconnected from server\");\n    };\n\n    return () => {\n      ws.current?.close();\n    };\n  }, [roomId, onUpdate, playerColor]);\n\n  const sendMove = (moveUCI: string) => {\n    if (ws.current?.readyState === WebSocket.OPEN) {\n      ws.current.send(JSON.stringify({ type: \"move\", move: moveUCI, room: roomId }));\n    }\n  };\n\n  return { sendMove, playerColor };\n}\n"],"mappings":"AAAA,OAASA,SAAS,CAAEC,MAAM,CAAEC,QAAQ,KAAQ,OAAO,CAEnD,MAAO,SAAS,CAAAC,cAAcA,CAC5BC,MAAc,CACdC,QAA4F,CAC5F,CACA,KAAM,CAAAC,EAAE,CAAGL,MAAM,CAAmB,IAAI,CAAC,CACzC,KAAM,CAACM,WAAW,CAAEC,cAAc,CAAC,CAAGN,QAAQ,CAA2B,IAAI,CAAC,CAE9EF,SAAS,CAAC,IAAM,CACdM,EAAE,CAACG,OAAO,CAAG,GAAI,CAAAC,SAAS,CAAC,qBAAqB,CAAC,CAEjDJ,EAAE,CAACG,OAAO,CAACE,MAAM,CAAG,IAAM,KAAAC,WAAA,CACxB,CAAAA,WAAA,CAAAN,EAAE,CAACG,OAAO,UAAAG,WAAA,iBAAVA,WAAA,CAAYC,IAAI,CAACC,IAAI,CAACC,SAAS,CAAC,CAAEC,IAAI,CAAE,MAAM,CAAEC,IAAI,CAAEb,MAAO,CAAC,CAAC,CAAC,CAClE,CAAC,CAEDE,EAAE,CAACG,OAAO,CAACS,SAAS,CAAIC,KAAK,EAAK,CAChC,KAAM,CAAAC,IAAI,CAAGN,IAAI,CAACO,KAAK,CAACF,KAAK,CAACC,IAAI,CAAC,CAEnC,OAAQA,IAAI,CAACJ,IAAI,EACf,IAAK,aAAa,CAChBR,cAAc,CAACY,IAAI,CAACE,KAAK,CAAC,CAC1B,MAEF,IAAK,OAAO,CACV;AACA,GAAIf,WAAW,CAAE,CACfF,QAAQ,CAACe,IAAI,CAACG,GAAG,CAAEH,IAAI,CAACI,IAAI,CAAEJ,IAAI,CAACK,QAAQ,EAAI,IAAI,CAAC,CACtD,CACA,MAEF,IAAK,OAAO,CACVC,KAAK,CAACN,IAAI,CAACO,GAAG,CAAC,CACf,MAEF,QACEC,OAAO,CAACC,IAAI,CAAC,uBAAuB,CAAET,IAAI,CAACJ,IAAI,CAAC,CACpD,CACF,CAAC,CAEDV,EAAE,CAACG,OAAO,CAACqB,OAAO,CAAG,IAAM,CACzBF,OAAO,CAACG,GAAG,CAAC,0BAA0B,CAAC,CACzC,CAAC,CAED,MAAO,IAAM,KAAAC,YAAA,CACX,CAAAA,YAAA,CAAA1B,EAAE,CAACG,OAAO,UAAAuB,YAAA,iBAAVA,YAAA,CAAYC,KAAK,CAAC,CAAC,CACrB,CAAC,CACH,CAAC,CAAE,CAAC7B,MAAM,CAAEC,QAAQ,CAAEE,WAAW,CAAC,CAAC,CAEnC,KAAM,CAAA2B,QAAQ,CAAIC,OAAe,EAAK,KAAAC,YAAA,CACpC,GAAI,EAAAA,YAAA,CAAA9B,EAAE,CAACG,OAAO,UAAA2B,YAAA,iBAAVA,YAAA,CAAYC,UAAU,IAAK3B,SAAS,CAAC4B,IAAI,CAAE,CAC7ChC,EAAE,CAACG,OAAO,CAACI,IAAI,CAACC,IAAI,CAACC,SAAS,CAAC,CAAEC,IAAI,CAAE,MAAM,CAAEuB,IAAI,CAAEJ,OAAO,CAAElB,IAAI,CAAEb,MAAO,CAAC,CAAC,CAAC,CAChF,CACF,CAAC,CAED,MAAO,CAAE8B,QAAQ,CAAE3B,WAAY,CAAC,CAClC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}