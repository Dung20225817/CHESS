{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState } from \"react\";\nexport function useChessSocket(roomId, onUpdate) {\n  _s();\n  const ws = useRef(null);\n  const [playerColor, setPlayerColor] = useState(null);\n  const onUpdateRef = useRef(onUpdate);\n  useEffect(() => {\n    onUpdateRef.current = onUpdate;\n  }, [onUpdate]);\n  useEffect(() => {\n    const proto = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const host = \"192.168.1.9:8765\";\n    ws.current = new WebSocket(`${proto}//${host}`);\n    ws.current.onopen = () => {\n      var _ws$current;\n      (_ws$current = ws.current) === null || _ws$current === void 0 ? void 0 : _ws$current.send(JSON.stringify({\n        type: \"join\",\n        room: roomId\n      }));\n    };\n    ws.current.onmessage = event => {\n      const matches = event.data.match(/{[^}]+}/g);\n      if (!matches) return;\n      for (const jsonStr of matches) {\n        try {\n          const data = JSON.parse(jsonStr);\n          switch (data.type) {\n            case \"assignColor\":\n              setPlayerColor(data.color);\n              break;\n            case \"state\":\n              onUpdateRef.current(data.fen, data.turn, null,\n              // gameOver ở đây null\n              undefined);\n              break;\n            case \"gameOver\":\n              onUpdateRef.current(\"\",\n              // hoặc giữ board cuối nếu muốn, nhưng server đã reset\n              \"white\",\n              // turn không quan trọng\n              data.winner,\n              // gameOver = winner\n              data.reason // event = reason\n              );\n              break;\n            case \"error\":\n              console.warn(\"Server error:\", data.msg);\n              break;\n            default:\n              console.warn(\"Unknown message type:\", data.type);\n          }\n        } catch (err) {\n          console.warn(\"Invalid JSON:\", jsonStr, err);\n        }\n      }\n    };\n    ws.current.onclose = () => {\n      console.log(\"Disconnected from server\");\n    };\n    return () => {\n      var _ws$current2;\n      (_ws$current2 = ws.current) === null || _ws$current2 === void 0 ? void 0 : _ws$current2.close();\n    };\n  }, [roomId]);\n  const sendMove = moveUCI => {\n    var _ws$current3;\n    if (!playerColor) return;\n    if (((_ws$current3 = ws.current) === null || _ws$current3 === void 0 ? void 0 : _ws$current3.readyState) === WebSocket.OPEN) {\n      const msg = JSON.stringify({\n        type: \"move\",\n        move: moveUCI,\n        room: roomId\n      });\n      console.log(\"[Client -> Bridge]\", msg);\n      ws.current.send(msg);\n    }\n  };\n  return {\n    sendMove,\n    playerColor\n  };\n}\n_s(useChessSocket, \"hZGfV5HmaA2OWzBmgCXCHJvkjZ8=\");","map":{"version":3,"names":["useEffect","useRef","useState","useChessSocket","roomId","onUpdate","_s","ws","playerColor","setPlayerColor","onUpdateRef","current","proto","window","location","protocol","host","WebSocket","onopen","_ws$current","send","JSON","stringify","type","room","onmessage","event","matches","data","match","jsonStr","parse","color","fen","turn","undefined","winner","reason","console","warn","msg","err","onclose","log","_ws$current2","close","sendMove","moveUCI","_ws$current3","readyState","OPEN","move"],"sources":["D:/CHESS/fe/src/components/hook/useChessSocket.ts"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\n\nexport function useChessSocket(\n  roomId: string,\n  onUpdate: (fen: string, turn: \"white\" | \"black\", gameOver: null | \"white\" | \"black\", event?: string) => void,\n) {\n  const ws = useRef<WebSocket | null>(null);\n  const [playerColor, setPlayerColor] = useState<\"white\" | \"black\" | null>(null);\n  const onUpdateRef = useRef(onUpdate);\n\n  useEffect(() => {\n    onUpdateRef.current = onUpdate;\n  }, [onUpdate]);\n\n  useEffect(() => {\n    const proto = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const host = \"192.168.1.9:8765\";\n    ws.current = new WebSocket(`${proto}//${host}`);\n\n    ws.current.onopen = () => {\n      ws.current?.send(JSON.stringify({ type: \"join\", room: roomId }));\n    };\n\n    ws.current.onmessage = (event) => {\n      const matches = event.data.match(/{[^}]+}/g);\n      if (!matches) return;\n\n      for (const jsonStr of matches) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          switch (data.type) {\n            case \"assignColor\":\n              setPlayerColor(data.color);\n              break;\n            case \"state\":\n              onUpdateRef.current(\n                data.fen,\n                data.turn,\n                null,           // gameOver ở đây null\n                undefined\n              );\n              break;\n            case \"gameOver\":\n              onUpdateRef.current(\n                \"\",                   // hoặc giữ board cuối nếu muốn, nhưng server đã reset\n                \"white\",              // turn không quan trọng\n                data.winner,          // gameOver = winner\n                data.reason           // event = reason\n              );\n              break;\n            case \"error\":\n              console.warn(\"Server error:\", data.msg);\n              break;\n            default:\n              console.warn(\"Unknown message type:\", data.type);\n          }\n        } catch (err) {\n          console.warn(\"Invalid JSON:\", jsonStr, err);\n        }\n      }\n    };\n\n\n\n    ws.current.onclose = () => {\n      console.log(\"Disconnected from server\");\n    };\n\n    return () => {\n      ws.current?.close();\n    };\n  }, [roomId]);\n\n  const sendMove = (moveUCI: string) => {\n    if (!playerColor) return;\n    if (ws.current?.readyState === WebSocket.OPEN) {\n      const msg = JSON.stringify({ type: \"move\", move: moveUCI, room: roomId });\n      console.log(\"[Client -> Bridge]\", msg);\n      ws.current.send(msg);\n    }\n  };\n\n  return { sendMove, playerColor };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}